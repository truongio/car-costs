<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Cost Calculator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%23ffffff'/%3E%3Cpath d='M20 40h60l-10 20H30z' fill='%23000'/%3E%3Ccircle cx='30' cy='70' r='8' fill='%23000'/%3E%3Ccircle cx='70' cy='70' r='8' fill='%23000'/%3E%3Cpath d='M25 40V30a10 10 0 0 1 10-10h30a10 10 0 0 1 10 10v10' stroke='%23000' stroke-width='3' fill='none'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnected" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'serif': ['EB Garamond', 'serif'],
                        'sans': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        black: '#0a0a0a',
                        offwhite: '#f7f7f7',
                        gray: {
                            100: '#f3f3f3',
                            200: '#e5e5e5',
                            300: '#d4d4d4',
                            400: '#a3a3a3',
                            500: '#737373',
                            900: '#171717',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Hide scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        /* Input styling reset */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }

        /* Smooth fade in for results */
        #results {
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        
        /* Custom underline animation for inputs */
        .input-container {
            position: relative;
        }
        
        .input-line {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background-color: #e5e5e5;
            transition: background-color 0.3s ease;
        }
        
        .input-container:focus-within .input-line {
            background-color: #0a0a0a;
            height: 2px;
        }

        .reveal-text {
            animation: reveal 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes reveal {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="font-sans bg-offwhite text-black min-h-screen flex flex-col items-center py-12 px-4 selection:bg-black selection:text-white">
    
    <div class="w-full max-w-2xl">
        <header class="mb-10 border-b border-black pb-6 reveal-text" style="animation-delay: 0.1s;">
            <h1 class="font-serif text-5xl md:text-6xl text-black tracking-tight leading-none">
                Car Cost <br/>
                <span class="italic text-gray-500">Calculator</span>
            </h1>
        </header>
        
        <div class="flex flex-wrap justify-center gap-x-6 gap-y-2 mb-12 text-xs font-sans font-medium uppercase tracking-widest text-gray-400 reveal-text" style="animation-delay: 0.15s;">
            <span>Examples:</span>
            <button onclick="loadPreset('tesla-y')" class="hover:text-black transition-colors">Tesla Model Y</button>
            <button onclick="loadPreset('volvo-xc60')" class="hover:text-black transition-colors">Volvo XC60</button>
            <button onclick="loadPreset('tesla-3')" class="hover:text-black transition-colors">Tesla Model 3</button>
        </div>
        
        <form id="carCostForm" class="space-y-12 mb-16">
            <!-- Primary Input -->
            <div class="input-container pb-2 reveal-text" style="animation-delay: 0.2s;">
                <label for="carPrice" class="block font-sans text-xs font-semibold uppercase tracking-widest text-gray-500 mb-2">Vehicle Purchase Price</label>
                <div class="flex items-baseline group">
                    <input type="text" id="carPrice" name="carPrice" required inputmode="numeric" placeholder="0"
                           class="font-serif w-auto min-w-[1ch] text-5xl md:text-6xl text-black placeholder-gray-200 border-none outline-none bg-transparent p-0 transition-colors">
                    <span class="font-serif text-3xl md:text-4xl text-gray-400 ml-3 italic relative -top-1">kr</span>
                </div>
                <div class="input-line"></div>
            </div>
            
            <!-- Secondary Grid -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-10">
                <div class="input-container pb-2 reveal-text" style="animation-delay: 0.3s;">
                    <label for="monthlyTax" class="block font-sans text-xs font-semibold uppercase tracking-widest text-gray-500 mb-2">Tax per Month</label>
                    <div class="flex items-baseline">
                        <input type="text" id="monthlyTax" name="monthlyTax" required value="30" inputmode="numeric"
                               class="font-serif w-auto min-w-[1ch] text-3xl text-black placeholder-gray-200 border-none outline-none bg-transparent p-0">
                        <span class="font-serif text-xl text-gray-400 ml-2 italic">kr</span>
                    </div>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-container pb-2 reveal-text" style="animation-delay: 0.35s;">
                    <label for="monthlyInsurance" class="block font-sans text-xs font-semibold uppercase tracking-widest text-gray-500 mb-2">Insurance per Month</label>
                    <div class="flex items-baseline">
                        <input type="text" id="monthlyInsurance" name="monthlyInsurance" required value="1 000" inputmode="numeric"
                               class="font-serif w-auto min-w-[1ch] text-3xl text-black placeholder-gray-200 border-none outline-none bg-transparent p-0">
                        <span class="font-serif text-xl text-gray-400 ml-2 italic">kr</span>
                    </div>
                    <div class="input-line"></div>
                </div>

                 <div class="input-container pb-2 reveal-text" style="animation-delay: 0.4s;">
                    <label for="ownershipYears" class="block font-sans text-xs font-semibold uppercase tracking-widest text-gray-500 mb-2">Ownership Period</label>
                    <div class="flex items-baseline">
                        <input type="text" id="ownershipYears" name="ownershipYears" required value="3" inputmode="numeric"
                               class="font-serif w-auto min-w-[1ch] text-3xl text-black placeholder-gray-200 border-none outline-none bg-transparent p-0">
                        <span class="font-serif text-xl text-gray-400 ml-2 italic">years</span>
                    </div>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-container pb-2 reveal-text" style="animation-delay: 0.45s;">
                    <label for="retainedValue" class="block font-sans text-xs font-semibold uppercase tracking-widest text-gray-500 mb-2">Residual Value</label>
                    <div class="flex items-baseline">
                        <input type="text" id="retainedValue" name="retainedValue" required value="50" inputmode="numeric"
                               class="font-serif w-auto min-w-[1ch] text-3xl text-black placeholder-gray-200 border-none outline-none bg-transparent p-0">
                        <span class="font-serif text-xl text-gray-400 ml-2 italic">%</span>
                    </div>
                    <div class="input-line"></div>
                </div>
            
                <div class="input-container pb-2 reveal-text" style="animation-delay: 0.5s;">
                    <label for="interestRate" class="block font-sans text-xs font-semibold uppercase tracking-widest text-gray-500 mb-2">Interest Rate</label>
                    <div class="flex items-baseline">
                        <input type="text" id="interestRate" name="interestRate" required value="2" inputmode="numeric"
                               class="font-serif w-auto min-w-[1ch] text-3xl text-black placeholder-gray-200 border-none outline-none bg-transparent p-0">
                        <span class="font-serif text-xl text-gray-400 ml-2 italic">%</span>
                    </div>
                    <div class="input-line"></div>
                </div>
                
                <div class="input-container pb-2 reveal-text" style="animation-delay: 0.55s;">
                    <label for="yearlyService" class="block font-sans text-xs font-semibold uppercase tracking-widest text-gray-500 mb-2">Service Cost per Year</label>
                    <div class="flex items-baseline">
                        <input type="text" id="yearlyService" name="yearlyService" required value="5 000" inputmode="numeric"
                               class="font-serif w-auto min-w-[1ch] text-3xl text-black placeholder-gray-200 border-none outline-none bg-transparent p-0">
                        <span class="font-serif text-xl text-gray-400 ml-2 italic">kr</span>
                    </div>
                    <div class="input-line"></div>
                </div>
            </div>
        </form>
        
        <div id="results" class="hidden opacity-0 border-t-2 border-black pt-10 pb-16">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
                <div class="md:col-span-5">
                    <div class="text-xs font-sans font-bold uppercase tracking-widest text-black mb-1">Total Monthly Cost</div>
                    <div class="text-xs font-sans text-gray-500">Estimated running costs including depreciation</div>
                </div>
                <div class="md:col-span-7 flex flex-col items-start md:items-end">
                    <div id="totalMonthlyCost" class="font-serif text-6xl md:text-7xl text-black leading-none mb-6">0 SEK</div>
                    
                    <button type="button" id="toggleDetails" class="group flex items-center gap-2 text-xs font-sans font-bold uppercase tracking-widest hover:bg-black hover:text-white px-4 py-2 border border-black transition-all duration-300">
                        <span>Show Breakdown</span>
                        <span class="text-lg leading-none transform transition-transform duration-300 group-hover:rotate-180">+</span>
                    </button>
                </div>
            </div>
            
            <div id="details" class="hidden mt-12 grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4 pt-8 border-t border-gray-200">
                <div class="flex justify-between items-baseline group hover:bg-gray-100 p-2 transition-colors -mx-2 rounded">
                    <span class="font-sans text-xs uppercase tracking-widest text-gray-500">Depreciation</span>
                    <span id="monthlyDepreciation" class="font-serif text-xl">0 kr</span>
                </div>
                <div class="flex justify-between items-baseline group hover:bg-gray-100 p-2 transition-colors -mx-2 rounded">
                    <span class="font-sans text-xs uppercase tracking-widest text-gray-500">Interest</span>
                    <span id="monthlyInterestCost" class="font-serif text-xl">0 kr</span>
                </div>
                <div class="flex justify-between items-baseline group hover:bg-gray-100 p-2 transition-colors -mx-2 rounded">
                    <span class="font-sans text-xs uppercase tracking-widest text-gray-500">Tax</span>
                    <span id="displayMonthlyTax" class="font-serif text-xl">0 kr</span>
                </div>
                <div class="flex justify-between items-baseline group hover:bg-gray-100 p-2 transition-colors -mx-2 rounded">
                    <span class="font-sans text-xs uppercase tracking-widest text-gray-500">Insurance</span>
                    <span id="displayMonthlyInsurance" class="font-serif text-xl">0 kr</span>
                </div>
                <div class="flex justify-between items-baseline group hover:bg-gray-100 p-2 transition-colors -mx-2 rounded">
                    <span class="font-sans text-xs uppercase tracking-widest text-gray-500">Service</span>
                    <span id="displayMonthlyService" class="font-serif text-xl">0 kr</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        const presets = {
            'tesla-y': {
                price: 650000, // Base Model RWD approx
                tax: 30,      // EV tax (360 kr/year)
                insurance: 800, // Halvförsäkring (new car warranty)
                service: 3000,   // Low maintenance + tires
                years: 3,
                retained: 55,    // High resale value
                interest: 6.0    // Current market rate
            },
            'volvo-xc60': {
                price: 780000,   // Recharge Plus approx
                tax: 30,         // Hybrid tax
                insurance: 600,  // Volvia halvförsäkring
                service: 5000,   // Annual service
                years: 3,
                retained: 52,
                interest: 6.0
            },
            'tesla-3': {
                price: 540000,   // Model 3 RWD
                tax: 30,
                insurance: 850,  // Halvförsäkring
                service: 3000,
                years: 3,
                retained: 53,
                interest: 6.0
            }
        };

        function loadPreset(model) {
            const data = presets[model];
            if (!data) return;

            const setInput = (id, value) => {
                const el = document.getElementById(id);
                el.value = formatSwedishNumber(value);
                resizeInput(el);
            };

            setInput('carPrice', data.price);
            setInput('monthlyTax', data.tax);
            setInput('monthlyInsurance', data.insurance);
            setInput('yearlyService', data.service);
            
            document.getElementById('ownershipYears').value = data.years;
            document.getElementById('retainedValue').value = data.retained;
            document.getElementById('interestRate').value = data.interest;

            calculateCosts();
        }

        function formatSwedishNumber(num) {
            if (isNaN(num) || num === 0) return '0';
            const rounded = Math.round(num);
            return rounded.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
        }
        
        function calculateCosts() {
            const carPrice = parseFloat(document.getElementById('carPrice').value.replace(/\s/g, '')) || 0;
            const monthlyTax = parseFloat(document.getElementById('monthlyTax').value.replace(/\s/g, '')) || 0;
            const monthlyInsurance = parseFloat(document.getElementById('monthlyInsurance').value.replace(/\s/g, '')) || 0;
            const ownershipYears = parseFloat(document.getElementById('ownershipYears').value) || 1;
            const retainedValuePercent = parseFloat(document.getElementById('retainedValue').value) || 0;
            const interestRate = parseFloat(document.getElementById('interestRate').value) || 0;
            const yearlyService = parseFloat(document.getElementById('yearlyService').value.replace(/\s/g, '')) || 0;
            
            // Check if we have meaningful inputs for all required fields
            const hasAllInputs = carPrice > 0 && monthlyTax >= 0 && monthlyInsurance >= 0 && ownershipYears > 0 && yearlyService >= 0;
            
            const resultsDiv = document.getElementById('results');
            
            if (hasAllInputs) {
                const totalMonths = ownershipYears * 12;
                const retainedValue = carPrice * (retainedValuePercent / 100);
                
                // Calculate monthly depreciation
                const totalDepreciation = carPrice - retainedValue;
                const monthlyDepreciation = totalDepreciation / totalMonths;
                
                // Calculate monthly interest cost (simple interest)
                const monthlyInterestCost = (carPrice * (interestRate / 100)) / 12;
                
                // Calculate monthly service cost
                const monthlyService = yearlyService / 12;
                
                const totalMonthlyCost = monthlyDepreciation + monthlyInterestCost + monthlyTax + monthlyInsurance + monthlyService;
                
                document.getElementById('monthlyDepreciation').textContent = formatSwedishNumber(monthlyDepreciation) + ' kr';
                document.getElementById('monthlyInterestCost').textContent = formatSwedishNumber(monthlyInterestCost) + ' kr';
                document.getElementById('displayMonthlyTax').textContent = formatSwedishNumber(monthlyTax) + ' kr';
                document.getElementById('displayMonthlyInsurance').textContent = formatSwedishNumber(monthlyInsurance) + ' kr';
                document.getElementById('displayMonthlyService').textContent = formatSwedishNumber(monthlyService) + ' kr';
                document.getElementById('totalMonthlyCost').textContent = formatSwedishNumber(totalMonthlyCost) + ' SEK';
                
                resultsDiv.classList.remove('hidden');
                // Small delay to allow display:block to apply before opacity transition
                setTimeout(() => resultsDiv.classList.remove('opacity-0'), 10);
            } else {
                resultsDiv.classList.add('opacity-0');
                // Wait for transition to finish before hiding
                setTimeout(() => resultsDiv.classList.add('hidden'), 600);
            }
        }
        
        function resizeInput(input) {
            let hiddenSpan = document.getElementById(input.id + '-measure');
            if (!hiddenSpan) {
                hiddenSpan = document.createElement('span');
                hiddenSpan.id = input.id + '-measure';
                hiddenSpan.style.visibility = 'hidden';
                hiddenSpan.style.position = 'absolute';
                hiddenSpan.style.whiteSpace = 'pre';
                hiddenSpan.style.height = '0';
                hiddenSpan.style.overflow = 'hidden';
                
                // Copy relevant font styles
                const style = window.getComputedStyle(input);
                hiddenSpan.style.fontFamily = style.fontFamily;
                hiddenSpan.style.fontSize = style.fontSize;
                hiddenSpan.style.fontWeight = style.fontWeight;
                hiddenSpan.style.fontStyle = style.fontStyle;
                hiddenSpan.style.letterSpacing = style.letterSpacing;
                hiddenSpan.style.textTransform = style.textTransform;
                
                document.body.appendChild(hiddenSpan);
            }
            // Use placeholder if value is empty, but we want the cursor to be visible 
            // so min width should be small.
            // If empty, we show placeholder. But placeholder width matters if we want 
            // placeholder to be fully visible? 
            // Actually, usually we just want it to fit the content. 
            // If empty, width should maybe be width of placeholder or just small?
            // Let's make it fit content (value) or placeholder if value is empty?
            // If value is empty, input shows placeholder.
            const text = input.value || input.placeholder || '';
            hiddenSpan.textContent = text;
            
            // Add a small buffer for cursor and to prevent jitter
            const width = hiddenSpan.offsetWidth + 10; 
            input.style.width = width + 'px';
        }

        function formatNumberInput(input) {
            let cursorPos = input.selectionStart;
            let oldValue = input.value;
            let value = input.value.replace(/\s/g, '');
            
            // Only allow digits
            value = value.replace(/[^\d]/g, '');
            
            if (value) {
                let formatted = value.replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
                
                // If we're typing at the end, keep cursor at end
                if (cursorPos >= oldValue.length) {
                    input.value = formatted;
                    input.setSelectionRange(formatted.length, formatted.length);
                } else {
                    // Count digits before cursor position in original value
                    let digitsBefore = oldValue.substring(0, cursorPos).replace(/[^\d]/g, '').length;
                    input.value = formatted;
                    
                    // Find new cursor position after digitsBefore digits
                    let newPos = 0;
                    let digitsFound = 0;
                    
                    for (let i = 0; i < formatted.length; i++) {
                        if (/\d/.test(formatted[i])) {
                            digitsFound++;
                            if (digitsFound === digitsBefore) {
                                newPos = i + 1;
                                break;
                            }
                        }
                    }
                    
                    input.setSelectionRange(newPos, newPos);
                }
            }
            
            resizeInput(input);
        }

        document.querySelectorAll('input').forEach(input => {
            // Initialize size
            resizeInput(input);
            
            // Add generic listener for non-formatted inputs (like percentage/years)
            input.addEventListener('input', function() {
                if (this.id === 'ownershipYears' || this.id === 'retainedValue' || this.id === 'interestRate') {
                     resizeInput(this);
                }
            });
        });

        document.getElementById('carPrice').addEventListener('input', function() {
            formatNumberInput(this);
            calculateCosts();
        });
        
        document.getElementById('monthlyTax').addEventListener('input', function() {
            formatNumberInput(this);
            calculateCosts();
        });
        
        document.getElementById('monthlyInsurance').addEventListener('input', function() {
            formatNumberInput(this);
            calculateCosts();
        });
        document.getElementById('yearlyService').addEventListener('input', function() {
            formatNumberInput(this);
            calculateCosts();
        });
        document.getElementById('ownershipYears').addEventListener('input', calculateCosts);
        document.getElementById('retainedValue').addEventListener('input', calculateCosts);
        document.getElementById('interestRate').addEventListener('input', calculateCosts);
        
        document.getElementById('toggleDetails').addEventListener('click', function() {
            const details = document.getElementById('details');
            const button = document.getElementById('toggleDetails');
            const spanText = button.querySelector('span:first-child');
            const spanIcon = button.querySelector('span:last-child');
            
            if (details.classList.contains('hidden')) {
                details.classList.remove('hidden');
                spanText.textContent = 'Hide Breakdown';
                spanIcon.textContent = '-';
            } else {
                details.classList.add('hidden');
                spanText.textContent = 'Show Breakdown';
                spanIcon.textContent = '+';
            }
        });
        
        document.getElementById('carCostForm').addEventListener('submit', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
